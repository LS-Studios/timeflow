{
  "rules": {
    "organizations": {
      ".indexOn": "adminUserId",
      "$serialNumber": {
        // Any authenticated user can read org data (e.g., to get the name when joining).
        ".read": "auth != null",
        // Write access is restricted to the user whose UID is stored in adminUserId.
        // This includes creating, updating (name, employees), and deleting.
        ".write": "auth != null && auth.uid === newData.child('adminUserId').val() || auth.uid === data.child('adminUserId').val()"
      }
    },
    "users": {
      "$userId": {
        // A user can always read and write their own data.
        // Additionally, an admin can read the data of a user who belongs to their organization.
        ".read": "auth != null && (auth.uid === $userId || root.child('organizations').child(root.child('users').child(auth.uid).child('settings/organizationSerialNumber').val()).child('employees').hasChild($userId))",
        ".write": "auth != null && auth.uid === $userId"
      }
    }
  }
}
